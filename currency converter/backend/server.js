const express = require("express");
const cors = require("cors");
const app = express();
const PORT = 3000;

app.use(cors());

// Hardcoded exchange rates (base: USD)
const rates = {
  USD: 1,
  INR: 83.2,
  EUR: 0.93,
  GBP: 0.79,
  JPY: 147.5,
  AUD: 1.53,
  CAD: 1.36,
  CNY: 7.29,
  CHF: 0.91,
  RUB: 92.5,
  SGD: 1.35,
  HKD: 7.85,
  NZD: 1.67,
  ZAR: 18.2,
  BRL: 5.1,
  MXN: 16.9,
  AED: 3.67,
  SAR: 3.75,
  TRY: 32.5,
  KRW: 1330,
  SEK: 10.7,
  NOK: 10.5,
  DKK: 6.9,
  PLN: 4.0,
  THB: 36.5,
  PKR: 278,
  IDR: 15700,
  MYR: 4.7,
  TWD: 32.2,
  VND: 25400,
  EGP: 47.5,
  BDT: 110,
  LKR: 305,
  NGN: 1500,
  UAH: 40.5,
  ARS: 900,
  COP: 3900,
  PEN: 3.7,
  CLP: 930,
  CZK: 23.2,
  HUF: 365,
  ILS: 3.8,
  IQD: 1310,
  IRR: 42000,
  KWD: 0.31,
  QAR: 3.64,
  OMR: 0.38,
  JOD: 0.71,
  BHD: 0.38,
  MAD: 10.1,
  DZD: 134,
  TND: 3.1,
  SYP: 13500,
  SDG: 600,
  XOF: 610,
  XAF: 610,
  GHS: 15.7,
  KES: 157,
  UGX: 3850,
  TZS: 2550,
  RWF: 1300,
  BWP: 13.5,
  ZMK: 22.5,
  ZWD: 5800,
  BYR: 3.2,
  UZS: 12700,
  GEL: 2.7,
  AMD: 390,
  AZN: 1.7,
  BAM: 1.8,
  BGN: 1.8,
  HRK: 7.5,
  MKD: 57.5,
  RSD: 108,
  ALL: 95,
  ISK: 140,
  MNT: 3400,
  KZT: 460,
  LAK: 21000,
  MOP: 8.1,
  MMK: 2100,
  MUR: 45.5,
  MVR: 15.3,
  NAD: 18.2,
  XPF: 110,
  FJD: 2.3,
  PGK: 3.8,
  SBD: 8.3,
  VUV: 120,
  YER: 250,
  BND: 1.35,
  KYD: 0.83,
  GIP: 0.79,
  JMD: 156,
  BSD: 1,
  BBD: 2,
  BMD: 1,
  BZD: 2,
  CUP: 24,
  DOP: 59,
  HTG: 132,
  SLL: 21000,
  SOS: 570,
  SRD: 36,
  STD: 22000,
  SVC: 8.75,
  SZL: 18.2,
  TOP: 2.4,
  TTD: 6.8,
  UYU: 39.5,
  VEF: 36,
  ANG: 1.8,
  AWG: 1.8,
  BOB: 6.9,
  GMD: 67,
  GTQ: 7.8,
  HNL: 24.7,
  LBP: 89500,
  MGA: 4500,
  MWK: 1700,
  MZN: 64,
  NPR: 133,
  PAB: 1,
  PHP: 58.5,
  PYG: 7300,
  SCR: 14.2,
  SSP: 1300,
  AFN: 77.5,
  BIF: 2850,
  CDF: 2770,
  DJF: 178,
  ERN: 15,
  GNF: 8700,
  KGS: 89.5,
  KMF: 450,
  LSL: 18.2,
  LTL: 3.2,
  LVL: 0.62,
  LYD: 4.8,
  MDL: 17.7,
  MRO: 39,
  MTL: 0.43,
  MWK: 1700,
  NAD: 18.2,
  NGN: 1500,
  RON: 4.6,
  SDG: 600,
  SKK: 30.1,
  SYP: 13500,
  SZL: 18.2,
  TJS: 10.9,
  TMT: 3.5,
  TND: 3.1,
  UAH: 40.5,
  UZS: 12700,
  VND: 25400,
  VUV: 120,
  YER: 250,
  ZMK: 22.5,
  ZWD: 5800,
};

// Support both /api/* and /* endpoints for compatibility
app.get(["/api/rates", "/rates"], (req, res) => {
  res.json(rates);
});

app.get(["/api/convert", "/convert"], (req, res) => {
  const { from, to, amount } = req.query;
  if (!rates[from] || !rates[to] || isNaN(amount)) {
    return res.status(400).json({ error: "Invalid parameters" });
  }
  // Convert from base (USD) to target
  const usdAmount = parseFloat(amount) / rates[from];
  const converted = usdAmount * rates[to];
  res.json({ result: converted });
});

// ...existing code...

app.listen(PORT, () => {
  console.log(`Currency API running on http://localhost:${PORT}`);
});
